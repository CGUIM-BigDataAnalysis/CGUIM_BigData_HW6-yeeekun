{
    "collab_server" : "",
    "contents" : "---\ntitle: \"長庚大學 大數據分析方法 作業六\"\noutput: github_document\n---\n\n## 分析議題背景\nPM 就是英文Particulate Matter（顆粒物）的縮寫。\nPM10代表空氣中空氣動力學粒徑小於等於10微米的所有顆粒物；\nPM2.5代表空氣中空氣動力學粒徑小於等於2.5微米的所有顆粒物；又稱細顆粒，細顆粒進入肺泡。 由此可見，PM10中包含粒徑小於2.5微米的顆粒物，即PM10包含PM2.5。世界衛生組織（WHO）指出： 對於發展中國家的城市：PM10中有近一半是PM2.5；\n對於已開發國家城市:PM10中PM2.5占50%至80%。由此，當空氣中PM2.5的濃度數據增加時，PM10的濃度數據就會升高。故目前歐盟國家仍然只監測PM10的濃度數據。\nPM10能被人直接吸入呼吸道，但部分可通過痰液等排出體外，也會被鼻腔內部的絨毛阻擋，對人體健康危害相對較小。不過PM10對於能見度和溫度的影響非常明顯。\nPM2.5通過呼吸可以到達肺部。這些顆粒物在肺泡上沉積下來，會干擾肺部的氣體交換，損傷肺泡和粘膜，引起肺組織的慢性纖維化，導致肺心病，加重哮喘病，引起慢性鼻咽炎、慢性支氣管炎等一系列病變，這些顆粒物還可以通過支氣管和肺泡進入血液，其中的有害氣體、重金屬等溶解在血液中，嚴重的可危及生命，對兒童和老年人的危害尤為明顯。\n\n\n\n## 分析動機\n相信大家都對PM10及PM2.5這幾個名詞不陌生了，也知道它對人體健康會有危害，因此我們找出開放資料，就北部幾個區域於2016/12/31這一天的情況來比較看看到底是哪裡的空氣最髒，再來看看工廠在各區的分布多寡和空氣汙染的高低有沒有關聯。\n\n## 使用資料\n關於讀入資料之欄位名稱及內容說明\n普通測站資料註記說明：\n`# 表示儀器檢核為無效值 \n* 表示程式檢核為無效值 \nx 表示人工檢核為無效值\nNR 表示無降雨\n空白 表示缺值\n\n測項簡稱    \t單位\t    測項名稱\nSO2 \t        ppb\t      二氧化硫\nCO\t          ppm\t      一氧化碳\nO3\t          ppb\t      臭氧\nPM10\t        μg/m3\t    懸浮微粒\nPM2.5\t        μg/m3\t    細懸浮微粒\nNOX\t          ppb\t      氮氧化物\nNO\t          ppb       一氧化氮\nNO2\t          ppb\t      二氧化氮\nTHC\t          ppm\t      總碳氫合物\nNMHC\t        ppm\t      非甲烷碳氫化合物\nCH4\t          ppm\t      甲烷\nUVB\t          UVI\t      紫外線指數\nAMB_TEMP\t    ℃         大氣溫度\nRAINFALL\t    mm    \t  雨量\nRH\t          %\t        相對溼度\nWIND_SPEED\t  m/sec\t    風速(以每小時最後10分鐘算術平均)\nWIND_DIREC\t  degress\t  風向(以每小時最後10分鐘向量平均)\nWS_HR\t        m/sec\t    風速小時值(以整個小時算術平均)\nWD_HR\t        degress\t  風向小時值(以整個小時向量平均)\nPH_RAIN\t      pH\t      酸鹼值(酸雨)\nRAIN_COND\t    μS/cm\t    導電度(酸雨)\n\n載入使用資料們\n```{r}\n#這是R Code Chunk\nlibrary(readr)\nlibrary(readxl)\nBanqiao <- read_excel(\"D:/BigDataHW/HW6/NewTaipeiCity/105年板橋站_20170217.xls\")\nLinkou <- read_excel(\"D:/BigDataHW/HW6/NewTaipeiCity/105年林口站_20170217.xls\")\nSanchong <- read_excel(\"D:/BigDataHW/HW6/NewTaipeiCity/105年三重站_20170217.xls\")\nTanshui <- read_excel(\"D:/BigDataHW/HW6/NewTaipeiCity/105年淡水站_20170217.xls\")\nTucheng <- read_excel(\"D:/BigDataHW/HW6/NewTaipeiCity/105年土城站_20170217.xls\")\nWanLi <- read_excel(\"D:/BigDataHW/HW6/NewTaipeiCity/105年萬里站_20170217.xls\")\nXinzhuang <- read_excel(\"D:/BigDataHW/HW6/NewTaipeiCity/105年新莊站_20170217.xls\")\nXizhi <- read_excel(\"D:/BigDataHW/HW6/NewTaipeiCity/105年汐止站_20170217.xls\")\nNewTaipeiFactoryLocation <- read_csv(\"D:/BigDataHW/HW6/NewTaipeiFactoryLocation_0002336861720153000188.csv\")\n```\n\n## 資料處理與清洗\n說明處理資料的步驟\n我們要先清洗出各站2016/12/31的資料，再把他們結合成一張表方便比對，再來將所有的數據charactor轉成num，由於資料表型態原本讀入是‘tbl_df’, ‘tbl’ and 'data.frame'，將字串轉成num時會有是資料是list所以物件無法強制轉成double的問題，因此在這裡先把資料表轉成data.frame再將資料型態轉換，再新增一個欄位求出當日的個數據平均。\n    而工廠清洗，我們先洗出還在生產中的工廠，再新增一個欄位Area填入區域，方便後便製圖以及比較，只用group_by和summarise求出每個區域有多少工廠，然後再以工廠數量來排序。\n處理資料\n```{r}\n#這是R Code Chunk\nAirAll<-rbind(Banqiao,Linkou,Sanchong,Tanshui,Tucheng,WanLi,Xinzhuang,Xizhi)\nAirPollution.20160231 <- rbind(\n  Banqiao[grepl(\"2016/12/31\",Banqiao$`日期`),],\n  Linkou[grepl(\"2016/12/31\",Linkou$`日期`),],\n  Sanchong[grepl(\"2016/12/31\",Sanchong$`日期`),],\n  Tanshui[grepl(\"2016/12/31\",Tanshui$`日期`),],\n  Tucheng[grepl(\"2016/12/31\",Tucheng$`日期`),],\n  WanLi[grepl(\"2016/12/31\",WanLi$`日期`),],\n  Xinzhuang[grepl(\"2016/12/31\",Xinzhuang$`日期`),],\n  Xizhi[grepl(\"2016/12/31\",Xizhi$`日期`),])\n\nAirPollution.20160231 <- as.data.frame(AirPollution.20160231)\nfor (i in 4:ncol(AirPollution.20160231)) {\n   if (!all(AirPollution.20160231[,i] %in% c(\"NR\",\" \",\"x\",\"*\",\"#\"))) {\n     AirPollution.20160231[,i] <- as.numeric(AirPollution.20160231[,i])\n   }\n}\nAirPollution.20160231$Average<- round(rowMeans(AirPollution.20160231[, 4:27],na.rm = TRUE),2)\nAirPollution.20160231 <- AirPollution.20160231[order(AirPollution.20160231$`測項`, -AirPollution.20160231$Average),]\nAir_Tidy<-AirPollution.20160231[,-4:-27]\n\n##工廠清洗\nfactory_operate <- NewTaipeiFactoryLocation[grepl(\"生產中\",NewTaipeiFactoryLocation$STATUS),]\nfactory_operate$Area <- substr(factory_operate$FACT_ADDR,4,6)\n#找出各區工廠數量，再以數量排序\nlibrary(dplyr)\nfactory_Area_Qunality <- group_by(factory_operate,Area)%>%summarise(nQuantity=n_distinct(REGI_ID))\nfactory_Area_Qunality <- arrange(factory_Area_Qunality,desc(nQuantity))\n#table(factory_operate$Area)\n\n\n```\n\n## 探索式資料分析\n圖文並茂圖文並茂\n```{r}\n##作圖事前準備\nlibrary(reshape2)\nlibrary(tidyr)\nlibrary(ggplot2)\n##長轉寬\nAir_Tidy.s <- spread(Air_Tidy, `測項`, Average)\n##寬轉長\nAir_Tidy.m <- melt(Air_Tidy, id.vars = c(\"日期\",\"測站\",\"測項\"))\n\n#雙變量----PM10跟PM2.5的相關性，看起來不太相關\ncor(Air_Tidy.s$PM10,Air_Tidy.s$PM2.5)\n\n#散佈圖\nggplot(data=Air_Tidy.s) +   \n    # 散布圖對應的函式是geom_point()\n    geom_point(aes(x=`測站`,  # 用aes()，描繪散布圖內的各種屬性\n                   y=PM2.5,\n                   main=\"Scatter Plot of PM2.5-測站\",\n                   color=`測站`,\n                   size=10)\n               ) + \n    # 用labs()，進行文字上的標註(Annotation)\n    labs(title=\"Scatter of PM2.5-Area\",\n         x=\"測站\",\n         y=\"PM2.5\") + theme_bw()\n\n#互動式圖表\n#library(plotly)\n#ggplotly()\n##要markdown不能用這個\n```\n\n## 期末專題分析規劃\n上面最後一張圖可以比較出八個區域中林口的PM2.5值最高，不知道與附近華亞工業區有沒有相關，後續將在期末報告做進一步研究觀察。\n在期末報告中，我們將研究\"各地區空氣品質汙染\"及\"各工廠種類\"的關係，利用工廠資訊中的STATUS、PRF、FACT_NAME、REGI_ID等欄位，取出正在運作中的工廠及種類、數量，再將取出之結果與空氣品質汙染檢測出的數值加叉比對，找出是否不同種類的工廠、數量會影響空氣品質。\n",
    "created" : 1495950514796.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3858470792",
    "id" : "A1EBA16F",
    "lastKnownWriteTime" : 1496247736,
    "last_content_update" : 1496247736700,
    "path" : "D:/Program Files/BigData_R_Hw/CGUIM_BigData_HW6-yeeekun/README.Rmd",
    "project_path" : "README.Rmd",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}